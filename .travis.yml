dist: trusty
sudo: required
language: elixir
elixir:
  - 1.7.2
otp_release:
  - 21.0
addons:
  postgresql: '9.5'
env:
  global:
    - PGPORT=5432
    - MIX_ENV=test VERBOSE_TEST=true

before_script:
  - nvm install 8.9.0

script:
  - mix format --check-formatted
  - mix compile --warnings-as-errors
  - mix coveralls
  - mix credo

before_deploy:
  - cd ./assets
  - yarn install
  - ./node_modules/.bin/brunch build -p
  - cd ..
  - MIX_ENV=prod mix phx.digest
  - MIX_ENV=prod mix release --env=prod

branches:
  only:
    - master
    - /^v[\d.]+/

deploy:
  skip_cleanup: true
  provider: releases
  api_key:
    secure: lneC//H9MWHiwdpqBu1vTSllrHMbJN9j67gF55M+P1mt5cBPbXfLdH6bYHiEfdpuA5olo7pvb0WNy+nhAqrpWZ0dHD4ot1HdJD0umJUP6Ls2sWt1hFHUvdDdESdz26ZNpY255wrzZ5jCi2D+dcG7VIUOSQWBHnV9ZVEMk+9EXF0eyF5S9yP2WkJlUnO3wHD4inbwp6FTTozJMj047ILciTh6jwmBG0nl6YOLKwGd4dXcS8mVFHdrn9J4xhAeXfmaF1Ai0ArHNSUFPf2l3LOqBEoc1SRDVC84duWtluDP/Sa2piN4CrtlSC8hbGMhBOvu2ch85H3KcBie6KudKEfdT8srIlQjabD/MiYepL9RgsUyibUPIvK9SYTJKsOLy4/0GBPvz8Ev+sAj18XImw+Y3y2t3ZLXq1Wv88P4ylJYXp5Jz0r2KiK6XKH8U7N33gLzZVtJ/CT2jlxve31faTwq4wUzonV4hvlfH+jJUszut4q4nMYQwrmc9PN16c4hb0BFnuRVkutpfvPvRLPbDCq+WvMj7/7n2CU7QcXb356Sng3i52kuUvTOxGJDzIRHLo/CD8Zem2ZcLjMjH+UyMnai1l++Ces1dJXXJzp5NjGoqM/QTiD5qvcYJsPH2ziRqs+9I7PD108ieLq/me4fcehRpPR19xrX6zxNOHnZOnRiCgw=
  file_glob: true
  file: _build/prod/rel/mcd/releases/*/*.tar.gz
  on:
    tags: true
