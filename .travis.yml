dist: trusty
sudo: required
language: elixir
elixir:
  - 1.7.2
otp_release:
  - 21.0
addons:
  postgresql: '9.5'
env:
  global:
    - PGPORT=5432
    - MIX_ENV=test VERBOSE_TEST=true

before_script:
  - nvm install 8.9.0

script:
  - mix format --check-formatted
  - mix compile --warnings-as-errors
  - mix coveralls
  - mix credo

before_deploy:
  - cd ./assets
  - yarn install
  - ./node_modules/.bin/brunch build -p
  - cd ..
  - MIX_ENV=prod mix phx.digest
  - MIX_ENV=prod mix release --env=prod

branches:
  only:
    - master
    - /^v[\d.]+/

deploy:
  skip_cleanup: true
  provider: releases
  api_key:
    secure: y/h3AsIyKJupNm6Ly9XyxI7IOZwn1PJuesPFyYPEW/Mj+wSZ5XiiKhkBczQ/THRyAs8A4u3h3MrI2odA2JoYiU4l16zGiaZUxgNFAg4DIBu3FKSXNOBatn48Iu5wV0UMa8Q4qrZByuSYCNXk/QtrRzchdfmr1ljA9b3JWxf6yZFqkxl+iJPW+s8llpNmjCYPCbvRaah5aUvIBOokhM198JvjmVzFgVdIrc485scoyLh2RKO5c41fu+GmkBLzPc6y4drhkjNF1KQcJbjS5AMLFCcjBQ2tpb1pyFOKvtLhXi4IkQ/Vq5WaCsTx1URmki4W7l6DzxkecTRrHWlVQNucUPLEPLQ4H1sYvMobBmJwwpt/1E2uydQ7OUeSYMao+9eu9edqS8JNZpvvO0hPbsF6ZaBPwt8NIagMM2tOA0tqOapKkvbHeloJaXVvFbzGKeivEQ6Q4yOQFsABYkf5Bp+PxG6/USJyRyyWATkqqkZCS+1xEQFR2Fbdww2fY8kYafuQNzu7ODhM+hvwvcmaRe7MmICUGBQXniyfAAS4JuX00+6+Gjq6pfaVUDaiHbPReTUbOphVPGKZBT2cJHxXkV84IQLZHz7CDD3ALRveaVqG3ngZBXMvrGjUfq7qHQwgvesRr+dGhSHjZtyZjU1mamGcrohn6JIv2I3V0O+vEY3O9uc=
  file_glob: true
  file: _build/prod/rel/mcd/releases/*/*.tar.gz
  on:
    tags: true
